#### Marginality Factor Analysis
Open source проект **коробочного аналитического решения** для  автоматизации **факторного анализа маржи (прибыли) и маржинальности** методом конечных подстановок.

**Варианты реализации:**
1. Аналитическое (BI) решение 
2. Часть комплексного продукта по управлению и планированию (S&OP)

**Состав проекта:**
* Инструкции по сборке витрин в реляционной СУБД **.sql**
* Макет сборки модели данных, расчёта бизнес логики и вариант визуализации для BI системы Power BI Report Server **.pbit**
* файл с документацией и инструкцией по сборке проекта **.md**

**Сборка Backend проекта (витрины данных)**
* Каждый  из .sql файлов содержит псевдокод на основе диалекта MS SQL для создания витрины и процедуры наполнения/обновления витрин
* Код снабжён комментариями, описывающими бизнес смысл каждого поля и необходимые преобразования
1. Откройте файлы **.sql** и создайте таблицы и процедуры в следующей последовательности:
* p_Marginality_Mes_Margin_week MM
* p_Marginality_Mes_Price_week_MM
* p_Marginality_Mes_Price_week_MM
* p_Marginality_Dim_Products_week_MM (зависим от Marginality_Mes_Margin_week)
2. Наполните витрины данными вашей компании
3. Для загрузки в макет Power BI Report Server названия полей витрин и типы данных должны строго соответстовать инструкции

**Инициализация Frontend проекта**
* Для первичной инициализации проекта и доступу к описанию бизнес логики расчётов необходима установка [Power BI Desktop Report Server](https://www.microsoft.com/en-us/download/details.aspx?id=106035) Установка не требует оплаты и лицензирования
* Макет проекта .pbit создан для версии Power BI Report Server (January 2024). При необходимости проверьте совестимость установленной у вас версии / обновите до совместимой
1. Скачайте макет **.pbit** на локальную машину и откройте файл
2. При открытии всплывёт окно загрузки данных. Нажмите **Load**
3. После старта загрузки всплывёт окно ввода пароля и доступа к БД. Нажмите **Cancel**
4. Всплывёт окно статуса загрузки данных с сообщениями об ошибке подключения. Нажмите **Close**
5. Закройте все всплывающие сообщения об ошибке. После этого автоматически загрузится модель данных, связи, код DAX мер и шаблоны визуализации
6. Сохраните макет в формате **.pbix**: File -> Save as -> Browse.
7. При сохранении во всплывающем окне с предложением сохранить изменения выберите **Apply later**
8. Закройте файл.
*Ожидаемый результат* - сохранённая модель проекта в формате **.pbix**

**Сборка Frontend проекта (Power BI)**
* При сборке Frontend проекта в Power BI Report Server или Power BI - замените источник данных для всех витрин на используемые в вашей компании согласно [инструкции Microsoft](https://learn.microsoft.com/ru-ru/power-bi/connect-data/desktop-connect-to-data) по подключению источников данных к PowerBI Desktop
* В макете источником выбран MS SQL Server. При необходимости замените на другой источник
* После замены источника на действующий проект автоматически наполнится данными. Расчёты и визуализации будут построены автоматически
* *Бизнес логика расчёта* показателей содержится *в мерах DAX* и подробно описана в комментариях к коду мер. Содержится в папке zz_dax_Measures в меню Data. Изучите описание и зависимости всех использованных формул

**Сборка Frontend проекта (альтернативный BI)**
* *Бизнес логика расчёта* показателей содержится *в мерах DAX* и подробно описана в комментариях к коду мер. Содержится в папке zz_dax_Measures в меню Data. Изучите описание и зависимости всех использованных формул
* Для переноса бизнес логики проекта в альтернативный BI инструмент рекомендуется наличие компетенций в области [DAX (Data Analysis Expressions)](https://learn.microsoft.com/ru-ru/dax/dax-overview) — языка формул и запросов, разработанный компанией Microsoft при этом не явлется обязательным
* Подробное описание бизнес логики и поэтапных расчётов, лежащих в основе проекта, находится [по ссылке](https://www.fpandaclub.com/handson/becoming-the-master-of-factor-analysis-of-profit-the-secrets-of-calculation). Пример поэтапного расчёта в формате Excel может быть использован в качетстве альтернативы для получения бизнес логики расчётов проекта













